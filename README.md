# crowd-detector

Приложение на Python с FastAPI и YOLO для автоматического детектирования людей на видео.  
На вход подаётся `.mp4` файл — на выходе возвращается видео с отрисованными рамками и уверенностями модели.

---

##  Установка и запуск

Выберите один из способов:

###  Установка через pip и запуск точки входа

```bash
git clone https://github.com/KuklanovMaks/crowd-detector.git
cd crowd-detector
pip install -r requirements.txt
python main.py
```

### Установка через Poetry (рекомендуется) и запуск точки входа

```bash
git clone https://github.com/KuklanovMaks/crowd-detector.git
cd crowd-detector
poetry install
poetry run python main.py
```

---

## Взаимодействие с UI в браузере

1. Откройте в браузере `http://127.0.0.1:8000`  
2. Загрузите `.mp4` видео через форму  
3. Дождитесь завершения обработки  
4. Браузер выдаст видео-результат в загрузки 

---

## Структура проекта

```
crowd-detector/
├── detection_tools/              # Модуль с логикой детекции
│   ├── __init__.py               
│   ├── detector.py               # Обёртка над YOLO-моделью
│   └── video_utils.py            # Функции обработки видео и загрузки в файл
├── templates/                    
│   └── index.html                # Форма загрузки видео
├── .gitignore                   
├── LICENSE                       
├── main.py                       # Точка входа: FastAPI-приложение
├── poetry.lock                   # Фиксация зависимостей Poetry
├── pyproject.toml                # Poetry-конфигурация проекта и зависимостей
├── README.md                     # Документация: описание, установка, запуск
├── requirements.txt              # Зависимости для установки через pip
```

---

## Результат

- Люди в кадре обведены зелёными рамками
- Над рамкой отображается название класса - "person" и уверенность модели "confidence"
- Результат сохраняется в `.mp4` файл и автоматически отдается пользователю

## Выводы по результатам работы модели 

- Модель уверенно детектирует людей в центральной части кадра при хорошем освещении и контрасте.
- Объекты в толпе и при частичном перекрытии также находятся с высокой уверенностью.
- Большинство мелких объектов на задних планах модель игнорирует либо даёт "мигающие" предсказания с уверенностью 5-10 %.
- Можно уверенно ставить низкий порог уверенности, потому что даже при пороге 0.05 модель практически не даёт ложно-положительных предсказаний, зато начинает искать людей на заднем плане. 
- Повышение разрешения кадров при подаче на вход yolo модели также даёт положительную корреляцию с поиском мелких и трудно-различимых объектов на заднем плане.

## Шаги по дальнейшему улучшению

1. Исходное видео имело хорошее качество: хорошая гистограмма яркости кадров, чёткие границы, отсутствие шума. При возможном использовании модели на менее качественных видео файлах, будет необходим покадровый препроцессинг.
2. Из-за постоянного перекрытия/исчезновения объектов из кадра bbox сильно "прыгают", можно попробовать temporal smoothing.
3. Необходима оптимизация скорости инференса модели. 
4. Дообучение yolo модели на кастомном датасете, содержащем изображения толп людей с разными степенями перекрытости отдельных объектов. 

